<!DOCTYPE html>

<html lang="zh-CN" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>cmake-packages(7) &mdash; CMake 3.29.1-g21d0c57 Documentation</title>

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a2c47e09" />
    <link rel="stylesheet" type="text/css" href="../_static/cmake.css?v=3e562cf9" />
    
    <script src="../_static/documentation_options.js?v=17f7ec5f"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    
    <link rel="icon" href="../_static/cmake-favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="cmake-policies(7)" href="cmake-policies.7.html" />
    <link rel="prev" title="CPackWIX" href="../module/CPackWIX.html" />
 

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="cmake-policies.7.html" title="cmake-policies(7)"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="../module/CPackWIX.html" title="CPackWIX"
             accesskey="P">上一页</a> |</li>
  <li>
    <img src="../_static/cmake-logo-16.png" alt=""
         style="vertical-align: middle; margin-top: -2px" />
  </li>
  <li>
    <a href="https://cmake.org/">CMake</a> &#187;
  </li>
  <li>
    <a href="../index.html">3.29.1-g21d0c57 Documentation</a> &#187;
  </li>

        <li class="nav-item nav-item-this"><a href="">cmake-packages(7)</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="manual:cmake-packages(7)"></span><section id="cmake-packages-7">
<h1><a class="toc-backref" href="#id18" role="doc-backlink">cmake-packages(7)</a><a class="headerlink" href="#cmake-packages-7" title="Link to this heading">¶</a></h1>
<nav class="contents" id="id1">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cmake-packages-7" id="id18">cmake-packages(7)</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id19">引言</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id20">使用包</a></p>
<ul>
<li><p><a class="reference internal" href="#config-file-packages" id="id21">配置文件包</a></p></li>
<li><p><a class="reference internal" href="#find" id="id22">Find模块包</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id5" id="id23">包布局</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id24">包配置文件</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id25">包版本文件</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-packages" id="id26">创建包</a></p>
<ul>
<li><p><a class="reference internal" href="#id9" id="id27">创建包配置文件</a></p>
<ul>
<li><p><a class="reference internal" href="#id10" id="id28">为构建树创建包配置文件</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-relocatable-packages" id="id29">创建浮动包</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#package-registry" id="id30">包注册</a></p>
<ul>
<li><p><a class="reference internal" href="#user-package-registry" id="id31">用户包注册</a></p></li>
<li><p><a class="reference internal" href="#system-package-registry" id="id32">系统包注册</a></p></li>
<li><p><a class="reference internal" href="#disabling-the-package-registry" id="id33">禁用包注册表</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id34">包注册例子</a></p></li>
<li><p><a class="reference internal" href="#id17" id="id35">包注册所有权</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">引言</a><a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>包为基于CMake的构建系统提供依赖信息。包可以通过<span class="target" id="index-0-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令找到。<span class="target" id="index-1-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>找到的结果要么是一组<span class="target" id="index-0-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标，要么是一组构建相关信息的对应变量。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">使用包</a><a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>CMake直接支持<a class="reference internal" href="#id4">配置文件包</a>和<a class="reference internal" href="#find">Find模块包</a>这两种形式的包。还可以通过<span class="target" id="index-0-module:FindPkgConfig"></span><a class="reference internal" href="../module/FindPkgConfig.html#module:FindPkgConfig" title="FindPkgConfig"><code class="xref cmake cmake-module docutils literal notranslate"><span class="pre">FindPkgConfig</span></code></a>模块提供对<code class="docutils literal notranslate"><span class="pre">pkg-config</span></code>包的间接支持。所有情况下调用<span class="target" id="index-2-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>的方法都是一样的：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt4</span><span class="w"> </span><span class="m">4.7.0</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span><span class="w"> </span><span class="c"># CMake provides a Qt4 find-module</span>
<span class="nf">find_package(</span><span class="nb">Qt5Core</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span><span class="w"> </span><span class="c"># Qt provides a Qt5 package config file.</span>
<span class="nf">find_package(</span><span class="nb">LibXml2</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span><span class="w"> </span><span class="c"># Use pkg-config via the LibXml2 find-module</span>
</pre></div>
</div>
<p>如果已知上游提供了一个包配置文件，并且只应该使用这个包配置文件，则<code class="docutils literal notranslate"><span class="pre">CONFIG</span></code>关键字可以传递给<span class="target" id="index-3-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt5Core</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">CONFIG</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span>
<span class="nf">find_package(</span><span class="nb">Qt5Gui</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">CONFIG</span><span class="nf">)</span>
</pre></div>
</div>
<p>类似地，<code class="docutils literal notranslate"><span class="pre">MODULE</span></code>关键字要求只使用find-module：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt4</span><span class="w"> </span><span class="m">4.7.0</span><span class="w"> </span><span class="no">MODULE</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span>
</pre></div>
</div>
<p>如果找不到包，显式指定包类型可以改进显示给用户的错误消息。</p>
<p>这两种类型的包还支持指定包的组件，可以列在<code class="docutils literal notranslate"><span class="pre">REQUIRED</span></code>关键字的后面：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt5</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">CONFIG</span><span class="w"> </span><span class="no">REQUIRED</span><span class="w"> </span><span class="nb">Widgets</span><span class="w"> </span><span class="nb">Xml</span><span class="w"> </span><span class="nb">Sql</span><span class="nf">)</span>
</pre></div>
</div>
<p>或者作为单独的<code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>列表：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt5</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">COMPONENTS</span><span class="w"> </span><span class="nb">Widgets</span><span class="w"> </span><span class="nb">Xml</span><span class="w"> </span><span class="nb">Sql</span><span class="nf">)</span>
</pre></div>
</div>
<p>或者作为单独的<code class="docutils literal notranslate"><span class="pre">OPTIONAL_COMPONENTS</span></code>列表：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">Qt5</span><span class="w"> </span><span class="m">5.1.0</span><span class="w"> </span><span class="no">COMPONENTS</span><span class="w"> </span><span class="nb">Widgets</span>
<span class="w">                       </span><span class="no">OPTIONAL_COMPONENTS</span><span class="w"> </span><span class="nb">Xml</span><span class="w"> </span><span class="nb">Sql</span>
<span class="nf">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>和<code class="docutils literal notranslate"><span class="pre">OPTIONAL_COMPONENTS</span></code>的处理由包定义。</p>
<p>通过将<span class="target" id="index-0-variable:CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt;"></span><a class="reference internal" href="../variable/CMAKE_DISABLE_FIND_PACKAGE_PackageName.html#variable:CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt;" title="CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt;"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt;</span></code></a>变量设置为<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>，<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;</span></code>包将不会被搜索，并且始终为<code class="docutils literal notranslate"><span class="pre">NOTFOUND</span></code>。同样地，通过将<span class="target" id="index-0-variable:CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt;"></span><a class="reference internal" href="../variable/CMAKE_REQUIRE_FIND_PACKAGE_PackageName.html#variable:CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt;" title="CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt;"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt;</span></code></a>设置为<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>表明包是必需的。</p>
<section id="config-file-packages">
<span id="id4"></span><h3><a class="toc-backref" href="#id21" role="doc-backlink">配置文件包</a><a class="headerlink" href="#config-file-packages" title="Link to this heading">¶</a></h3>
<p>配置文件包是上游提供给下游使用的一组文件。如<span class="target" id="index-4-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>文档所述，CMake会在多个位置搜索包配置文件。若想让<span class="target" id="index-0-manual:cmake(1)"></span><a class="reference internal" href="cmake.1.html#manual:cmake(1)" title="cmake(1)"><code class="xref cmake cmake-manual docutils literal notranslate"><span class="pre">cmake(1)</span></code></a>在非标准前缀中搜索包，最简单方法是设置<code class="docutils literal notranslate"><span class="pre">CMAKE_PREFIX_PATH</span></code>缓存变量。</p>
<p>配置文件包由上游供应提供，作为开发包的一部分，也就是说，它们由头文件或者其他为帮助下游使用包而提供的任何文件组成。</p>
<p>当使用配置文件包时，还会自动设置一组提供包状态信息的变量。根据是否找到了包，<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_FOUND</span></code>变量被设置为true或者false。而<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_DIR</span></code>缓存变量则被设置为包配置文件的位置。</p>
</section>
<section id="find">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Find模块包</a><a class="headerlink" href="#find" title="Link to this heading">¶</a></h3>
<p>find模块是一个包含一组规则的文件，用于查找依赖项所需的部分，主要是头文件和库。通常，当上游不是用CMake构建的，或者没有足够的CMake感知来提供包配置文件时，就需要一个find模块。与包配置文件不同，它不是由上游提供的，而是由下游使用特定于平台的提示来猜测文件的位置。</p>
<p>与上游提供的包配置文件的情况不同，没有单个引用点标识正在找到的包，因此<span class="target" id="index-5-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令不会自动设置<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_FOUND</span></code>变量。但是，它仍然可以依约定设置，并且应该由Find模块的作者设置。类似地，没有<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_DIR</span></code>变量，但是每个构件，例如库位置和头文件位置，将提供一个单独的缓存变量。</p>
<p>有关创建Find模块文件的更多信息，请参考<span class="target" id="index-0-manual:cmake-developer(7)"></span><a class="reference internal" href="cmake-developer.7.html#manual:cmake-developer(7)" title="cmake-developer(7)"><code class="xref cmake cmake-manual docutils literal notranslate"><span class="pre">cmake-developer(7)</span></code></a>手册。</p>
</section>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">包布局</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>配置文件包由<a class="reference internal" href="#id6">包配置文件</a>和可选的由项目分发方提供的<a class="reference internal" href="#id7">包版本文件</a>组成。</p>
<section id="id6">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">包配置文件</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>考虑一个安装了以下文件的项目<code class="docutils literal notranslate"><span class="pre">Foo</span></code>：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;/include/foo-1.2/foo.h
&lt;prefix&gt;/lib/foo-1.2/libfoo.a
</pre></div>
</div>
<p>它还可以提供一个CMake包配置文件：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;/lib/cmake/foo-1.2/FooConfig.cmake
</pre></div>
</div>
<p>内容是定义<span class="target" id="index-1-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标，或定义变量，如：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># ...</span>
<span class="c"># (compute PREFIX relative to file location)</span>
<span class="c"># ...</span>
<span class="nf">set(</span><span class="nb">Foo_INCLUDE_DIRS</span><span class="w"> </span><span class="o">${</span><span class="nt">PREFIX</span><span class="o">}</span><span class="na">/include/foo-1.2</span><span class="nf">)</span>
<span class="nf">set(</span><span class="nb">Foo_LIBRARIES</span><span class="w"> </span><span class="o">${</span><span class="nt">PREFIX</span><span class="o">}</span><span class="na">/lib/foo-1.2/libfoo.a</span><span class="nf">)</span>
</pre></div>
</div>
<p>如果另一个项目希望使用<code class="docutils literal notranslate"><span class="pre">Foo</span></code>，它只需要找到<code class="docutils literal notranslate"><span class="pre">FooConfig.cmake</span></code>文件，并加载它以获得它所需要的关于包内容位置的所有信息。因为包配置文件是由包安装提供的，所以它已经知道所有文件的位置。</p>
<p>可以用<span class="target" id="index-6-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令搜索包配置文件。该命令构造一组安装前缀，并在几个位置的每个前缀下搜索。给定名称<code class="docutils literal notranslate"><span class="pre">Foo</span></code>，它查找名为<code class="docutils literal notranslate"><span class="pre">FooConfig.cmake</span></code>或<code class="docutils literal notranslate"><span class="pre">foo-config.cmake</span></code>的文件。完整的位置集合在<span class="target" id="index-7-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令文档中指定。其中一个地方是：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;/lib/cmake/Foo*/
</pre></div>
</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">Foo*</span></code>是不区分大小写的通配符表达式。在我们的示例中，通配符表达式将匹配<code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;/lib/cmake/foo-1.2</span></code>，并将找到包配置文件。</p>
<p>一旦找到，立即加载包配置文件。它和一个包版本文件一起包含了项目使用该包所需的所有信息。</p>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">包版本文件</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>当<span class="target" id="index-8-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令找到一个候选包配置文件时，它会在它旁边查找版本文件。加载版本文件以测试包版本是否与所请求的版本匹配。如果版本文件有版本要求，则接受配置文件。否则将被忽略。</p>
<p>包版本文件的名称必须与包配置文件的名称匹配，但是在扩展名<code class="docutils literal notranslate"><span class="pre">.cmake</span></code>之前附加<code class="docutils literal notranslate"><span class="pre">-version</span></code>或 <code class="docutils literal notranslate"><span class="pre">Version</span></code>。例如，文件：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;/lib/cmake/foo-1.3/foo-config.cmake
&lt;prefix&gt;/lib/cmake/foo-1.3/foo-config-version.cmake
</pre></div>
</div>
<p>和：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;prefix&gt;/lib/cmake/bar-4.2/BarConfig.cmake
&lt;prefix&gt;/lib/cmake/bar-4.2/BarConfigVersion.cmake
</pre></div>
</div>
<p>是每对包配置文件和对应的包版本文件。</p>
<p>当<span class="target" id="index-9-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令加载一个版本文件时，会首先设置以下变量：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_NAME</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION</span></code></dt><dd><p>获取的完整版本字符串</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION_MAJOR</span></code></dt><dd><p>获取成功时为主版本号，失败则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION_MINOR</span></code></dt><dd><p>获取成功时为次版本号，失败则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION_PATCH</span></code></dt><dd><p>获取成功时为补丁版本号，失败则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION_TWEAK</span></code></dt><dd><p>获取成功时为修订版本号，失败则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_FIND_VERSION_COUNT</span></code></dt><dd><p>版本号数量，取值范围0至4</p>
</dd>
</dl>
<p>版本文件必须使用这些变量来检查它是否与请求的版本兼容或完全匹配，并设置以下变量：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_VERSION</span></code></dt><dd><p>完整提供的版本字符串</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_VERSION_EXACT</span></code></dt><dd><p>如果版本完全匹配则为True</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_VERSION_COMPATIBLE</span></code></dt><dd><p>如果版本兼容则为True</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PACKAGE_VERSION_UNSUITABLE</span></code></dt><dd><p>如果不适配任何版本，则为True</p>
</dd>
</dl>
<p>版本文件被加载在一个嵌套的作用域中，因此他们可以自由地设置任何他们想要的变量作为计算的一部分。当版本文件完成并检查了输出变量后，find_package命令会清空作用域。当版本文件声明与请求的版本匹配可接受时，find_package命令设置以下变量供项目使用：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION</span></code></dt><dd><p>完整的版本字符串</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION_MAJOR</span></code></dt><dd><p>主版本号，若未提供，则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION_MINOR</span></code></dt><dd><p>次版本号，若未提供，则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION_PATCH</span></code></dt><dd><p>补丁版本号，若未提供，则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION_TWEAK</span></code></dt><dd><p>修订版本号，若未提供，则为0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;_VERSION_COUNT</span></code></dt><dd><p>提供的版本号数量，取值范围0至4</p>
</dd>
</dl>
<p>这些变量报告实际找到的包的版本。其名称中的<code class="docutils literal notranslate"><span class="pre">&lt;包名&gt;</span></code>部分与<span class="target" id="index-10-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令的参数相匹配。</p>
</section>
</section>
<section id="creating-packages">
<span id="id8"></span><h2><a class="toc-backref" href="#id26" role="doc-backlink">创建包</a><a class="headerlink" href="#creating-packages" title="Link to this heading">¶</a></h2>
<p>通常，上游依赖于CMake本身，可以使用一些CMake工具来创建包文件。譬如一个提供单个共享库的游：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">project(</span><span class="nb">UpstreamLib</span><span class="nf">)</span>

<span class="nf">set(</span><span class="no">CMAKE_INCLUDE_CURRENT_DIR</span><span class="w"> </span><span class="no">ON</span><span class="nf">)</span>
<span class="nf">set(</span><span class="no">CMAKE_INCLUDE_CURRENT_DIR_IN_INTERFACE</span><span class="w"> </span><span class="no">ON</span><span class="nf">)</span>

<span class="nf">set(</span><span class="nb">Upstream_VERSION</span><span class="w"> </span><span class="m">3.4.1</span><span class="nf">)</span>

<span class="nf">include(</span><span class="nb">GenerateExportHeader</span><span class="nf">)</span>

<span class="nf">add_library(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">SHARED</span><span class="w"> </span><span class="nb">climbingstats.cpp</span><span class="nf">)</span>
<span class="nf">generate_export_header(</span><span class="nb">ClimbingStats</span><span class="nf">)</span>
<span class="nf">set_property(</span><span class="no">TARGET</span><span class="w"> </span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">PROPERTY</span><span class="w"> </span><span class="no">VERSION</span><span class="w"> </span><span class="o">${</span><span class="nt">Upstream_VERSION</span><span class="o">}</span><span class="nf">)</span>
<span class="nf">set_property(</span><span class="no">TARGET</span><span class="w"> </span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">PROPERTY</span><span class="w"> </span><span class="no">SOVERSION</span><span class="w"> </span><span class="m">3</span><span class="nf">)</span>
<span class="nf">set_property(</span><span class="no">TARGET</span><span class="w"> </span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">PROPERTY</span>
<span class="w">  </span><span class="nb">INTERFACE_ClimbingStats_MAJOR_VERSION</span><span class="w"> </span><span class="m">3</span><span class="nf">)</span>
<span class="nf">set_property(</span><span class="no">TARGET</span><span class="w"> </span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">APPEND</span><span class="w"> </span><span class="no">PROPERTY</span>
<span class="w">  </span><span class="no">COMPATIBLE_INTERFACE_STRING</span><span class="w"> </span><span class="nb">ClimbingStats_MAJOR_VERSION</span>
<span class="nf">)</span>

<span class="nf">install(</span><span class="no">TARGETS</span><span class="w"> </span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">EXPORT</span><span class="w"> </span><span class="nb">ClimbingStatsTargets</span>
<span class="w">  </span><span class="no">LIBRARY</span><span class="w"> </span><span class="no">DESTINATION</span><span class="w"> </span><span class="nb">lib</span>
<span class="w">  </span><span class="no">ARCHIVE</span><span class="w"> </span><span class="no">DESTINATION</span><span class="w"> </span><span class="nb">lib</span>
<span class="w">  </span><span class="no">RUNTIME</span><span class="w"> </span><span class="no">DESTINATION</span><span class="w"> </span><span class="nb">bin</span>
<span class="w">  </span><span class="no">INCLUDES</span><span class="w"> </span><span class="no">DESTINATION</span><span class="w"> </span><span class="nb">include</span>
<span class="nf">)</span>
<span class="nf">install(</span>
<span class="w">  </span><span class="no">FILES</span>
<span class="w">    </span><span class="nb">climbingstats.h</span>
<span class="w">    </span><span class="s">&quot;${CMAKE_CURRENT_BINARY_DIR}/climbingstats_export.h&quot;</span>
<span class="w">  </span><span class="no">DESTINATION</span>
<span class="w">    </span><span class="nb">include</span>
<span class="w">  </span><span class="no">COMPONENT</span>
<span class="w">    </span><span class="nb">Devel</span>
<span class="nf">)</span>

<span class="nf">include(</span><span class="nb">CMakePackageConfigHelpers</span><span class="nf">)</span>
<span class="nf">write_basic_package_version_file(</span>
<span class="w">  </span><span class="s">&quot;${CMAKE_CURRENT_BINARY_DIR}/ClimbingStats/ClimbingStatsConfigVersion.cmake&quot;</span>
<span class="w">  </span><span class="no">VERSION</span><span class="w"> </span><span class="o">${</span><span class="nt">Upstream_VERSION</span><span class="o">}</span>
<span class="w">  </span><span class="no">COMPATIBILITY</span><span class="w"> </span><span class="nb">AnyNewerVersion</span>
<span class="nf">)</span>

<span class="nf">export(</span><span class="no">EXPORT</span><span class="w"> </span><span class="nb">ClimbingStatsTargets</span>
<span class="w">  </span><span class="no">FILE</span><span class="w"> </span><span class="s">&quot;${CMAKE_CURRENT_BINARY_DIR}/ClimbingStats/ClimbingStatsTargets.cmake&quot;</span>
<span class="w">  </span><span class="no">NAMESPACE</span><span class="w"> </span><span class="nb">Upstream</span><span class="o">::</span>
<span class="nf">)</span>
<span class="nf">configure_file(</span><span class="na">cmake/ClimbingStatsConfig.cmake</span>
<span class="w">  </span><span class="s">&quot;${CMAKE_CURRENT_BINARY_DIR}/ClimbingStats/ClimbingStatsConfig.cmake&quot;</span>
<span class="w">  </span><span class="no">COPYONLY</span>
<span class="nf">)</span>

<span class="nf">set(</span><span class="nb">ConfigPackageLocation</span><span class="w"> </span><span class="na">lib/cmake/ClimbingStats</span><span class="nf">)</span>
<span class="nf">install(</span><span class="no">EXPORT</span><span class="w"> </span><span class="nb">ClimbingStatsTargets</span>
<span class="w">  </span><span class="no">FILE</span>
<span class="w">    </span><span class="nb">ClimbingStatsTargets.cmake</span>
<span class="w">  </span><span class="no">NAMESPACE</span>
<span class="w">    </span><span class="nb">Upstream</span><span class="o">::</span>
<span class="w">  </span><span class="no">DESTINATION</span>
<span class="w">    </span><span class="o">${</span><span class="nt">ConfigPackageLocation</span><span class="o">}</span>
<span class="nf">)</span>
<span class="nf">install(</span>
<span class="w">  </span><span class="no">FILES</span>
<span class="w">    </span><span class="na">cmake/ClimbingStatsConfig.cmake</span>
<span class="w">    </span><span class="s">&quot;${CMAKE_CURRENT_BINARY_DIR}/ClimbingStats/ClimbingStatsConfigVersion.cmake&quot;</span>
<span class="w">  </span><span class="no">DESTINATION</span>
<span class="w">    </span><span class="o">${</span><span class="nt">ConfigPackageLocation</span><span class="o">}</span>
<span class="w">  </span><span class="no">COMPONENT</span>
<span class="w">    </span><span class="nb">Devel</span>
<span class="nf">)</span>
</pre></div>
</div>
<p><span class="target" id="index-0-module:CMakePackageConfigHelpers"></span><a class="reference internal" href="../module/CMakePackageConfigHelpers.html#module:CMakePackageConfigHelpers" title="CMakePackageConfigHelpers"><code class="xref cmake cmake-module docutils literal notranslate"><span class="pre">CMakePackageConfigHelpers</span></code></a>模块提供了一个宏来创建一个简单的<code class="docutils literal notranslate"><span class="pre">ConfigVersion.cmake</span></code>文件，作用是设置包的版本。当调用<span class="target" id="index-11-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>时，CMake读取它，以确定与请求版本的兼容性，并设置一些版本特定变量如<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_VERSION</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_VERSION_MAJOR</span></code>、<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_VERSION_MINOR</span></code>等。<span class="target" id="index-0-command:install"></span><a class="reference internal" href="../command/install.html#export" title="install(export)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">install(EXPORT)</span></code></a>命令用于导出<code class="docutils literal notranslate"><span class="pre">ClimbingStatsTargets.cmake</span></code>导出集中的目标，该导出集之前由<span class="target" id="index-1-command:install"></span><a class="reference internal" href="../command/install.html#targets" title="install(targets)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">install(TARGETS)</span></code></a>命令定义。这个命令生成的<code class="docutils literal notranslate"><span class="pre">ClimbingStatsTargets.cmake</span></code>文件包含适用于下游的<span class="target" id="index-2-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标，并会安装到<code class="docutils literal notranslate"><span class="pre">lib/cmake/ClimbingStats</span></code>。生成的<code class="docutils literal notranslate"><span class="pre">ClimbingStatsConfigVersion.cmake</span></code>和<code class="docutils literal notranslate"><span class="pre">cmake/ClimbingStatsConfig.cmake</span></code>会安装到相同的位置以完成包的安装。</p>
<p>生成的<span class="target" id="index-3-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标设置了适当的属性来定义它们的<a class="reference internal" href="cmake-buildsystem.7.html#target-usage-requirements"><span class="std std-ref">使用需求</span></a>，例如<span class="target" id="index-0-prop_tgt:INTERFACE_INCLUDE_DIRECTORIES"></span><a class="reference internal" href="../prop_tgt/INTERFACE_INCLUDE_DIRECTORIES.html#prop_tgt:INTERFACE_INCLUDE_DIRECTORIES" title="INTERFACE_INCLUDE_DIRECTORIES"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_INCLUDE_DIRECTORIES</span></code></a>、<span class="target" id="index-0-prop_tgt:INTERFACE_COMPILE_DEFINITIONS"></span><a class="reference internal" href="../prop_tgt/INTERFACE_COMPILE_DEFINITIONS.html#prop_tgt:INTERFACE_COMPILE_DEFINITIONS" title="INTERFACE_COMPILE_DEFINITIONS"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_COMPILE_DEFINITIONS</span></code></a>及其他相关的内置<code class="docutils literal notranslate"><span class="pre">INTERFACE_</span></code>属性。在<span class="target" id="index-0-prop_tgt:COMPATIBLE_INTERFACE_STRING"></span><a class="reference internal" href="../prop_tgt/COMPATIBLE_INTERFACE_STRING.html#prop_tgt:COMPATIBLE_INTERFACE_STRING" title="COMPATIBLE_INTERFACE_STRING"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">COMPATIBLE_INTERFACE_STRING</span></code></a>和其他<a class="reference internal" href="cmake-buildsystem.7.html#compatible-interface-properties"><span class="std std-ref">兼容的接口属性</span></a>中列出的自定义属性的<code class="docutils literal notranslate"><span class="pre">INTERFACE</span></code>变体也会传播到生成的<span class="target" id="index-4-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标。在上面的例子中，<code class="docutils literal notranslate"><span class="pre">ClimbingStats_MAJOR_VERSION</span></code>被定义为一个字符串，它必须在任何依赖的依赖项之间兼容。在<code class="docutils literal notranslate"><span class="pre">ClimbingStats</span></code>的这个和下一个版本中都设置这个自定义属性的情况下，如果试图同时使用版本3和版本4，<span class="target" id="index-1-manual:cmake(1)"></span><a class="reference internal" href="cmake.1.html#manual:cmake(1)" title="cmake(1)"><code class="xref cmake cmake-manual docutils literal notranslate"><span class="pre">cmake(1)</span></code></a>将发出诊断。如果包的不同主要版本互不兼容，就可以选择使用这种模式。</p>
<p>导出用于安装的目标时指定一个带双冒号的<code class="docutils literal notranslate"><span class="pre">NAMESPACE</span></code>。当下游使用<span class="target" id="index-0-command:target_link_libraries"></span><a class="reference internal" href="../command/target_link_libraries.html#command:target_link_libraries" title="target_link_libraries"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">target_link_libraries()</span></code></a>命令时，这种双冒号的约定给CMake一个提示：该名称是一个<span class="target" id="index-5-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标。这样，如果找不到相应的包，CMake就可以发出诊断。</p>
<p>在本例中，当使用<span class="target" id="index-2-command:install"></span><a class="reference internal" href="../command/install.html#targets" title="install(targets)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">install(TARGETS)</span></code></a>时指定了<code class="docutils literal notranslate"><span class="pre">INCLUDES</span> <span class="pre">DESTINATION</span></code>。这将会令<code class="docutils literal notranslate"><span class="pre">IMPORTED</span></code>目标的<span class="target" id="index-1-prop_tgt:INTERFACE_INCLUDE_DIRECTORIES"></span><a class="reference internal" href="../prop_tgt/INTERFACE_INCLUDE_DIRECTORIES.html#prop_tgt:INTERFACE_INCLUDE_DIRECTORIES" title="INTERFACE_INCLUDE_DIRECTORIES"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_INCLUDE_DIRECTORIES</span></code></a>属性被<span class="target" id="index-0-variable:CMAKE_INSTALL_PREFIX"></span><a class="reference internal" href="../variable/CMAKE_INSTALL_PREFIX.html#variable:CMAKE_INSTALL_PREFIX" title="CMAKE_INSTALL_PREFIX"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code></a>中的<code class="docutils literal notranslate"><span class="pre">include</span></code>目录填充。当下游使用<code class="docutils literal notranslate"><span class="pre">IMPORTED</span></code>目标时，它会自动使用来自该属性的项。</p>
<section id="id9">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">创建包配置文件</a><a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>在这种情况下，<code class="docutils literal notranslate"><span class="pre">ClimbingStatsConfig.cmake</span></code>文件可以像下面那样简单：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStatsTargets.cmake&quot;</span><span class="nf">)</span>
</pre></div>
</div>
<p>因为这允许下游使用<code class="docutils literal notranslate"><span class="pre">IMPORTED</span></code>的目标。如果<code class="docutils literal notranslate"><span class="pre">ClimbingStats</span></code>包需要提供任何宏，那么它们应该在一个单独的文件中，该文件与<code class="docutils literal notranslate"><span class="pre">ClimbingStatsConfig.cmake</span></code>安装在相同的位置，并在那里被引用。</p>
<p>这也可以扩展到覆盖的依赖项：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># ...</span>
<span class="nf">add_library(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">SHARED</span><span class="w"> </span><span class="nb">climbingstats.cpp</span><span class="nf">)</span>
<span class="nf">generate_export_header(</span><span class="nb">ClimbingStats</span><span class="nf">)</span>

<span class="nf">find_package(</span><span class="nb">Stats</span><span class="w"> </span><span class="m">2.6.4</span><span class="w"> </span><span class="no">REQUIRED</span><span class="nf">)</span>
<span class="nf">target_link_libraries(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">PUBLIC</span><span class="w"> </span><span class="nb">Stats</span><span class="o">::</span><span class="nb">Types</span><span class="nf">)</span>
</pre></div>
</div>
<p>由于<code class="docutils literal notranslate"><span class="pre">Stats::Types</span></code>目标是<code class="docutils literal notranslate"><span class="pre">ClimbingStats</span></code>的<code class="docutils literal notranslate"><span class="pre">PUBLIC</span></code>依赖项，下游也必须找到<code class="docutils literal notranslate"><span class="pre">Stats</span></code>包并链接到<code class="docutils literal notranslate"><span class="pre">Stats::Types</span></code>库。<code class="docutils literal notranslate"><span class="pre">Stats</span></code>包应该在<code class="docutils literal notranslate"><span class="pre">ClimbingStatsConfig.cmake</span></code>文件中找到，以此确保这一点。来自<span class="target" id="index-0-module:CMakeFindDependencyMacro"></span><a class="reference internal" href="../module/CMakeFindDependencyMacro.html#module:CMakeFindDependencyMacro" title="CMakeFindDependencyMacro"><code class="xref cmake cmake-module docutils literal notranslate"><span class="pre">CMakeFindDependencyMacro</span></code></a>的<code class="docutils literal notranslate"><span class="pre">find_dependency</span></code>宏可以通过传播包是<code class="docutils literal notranslate"><span class="pre">REQUIRED</span></code>还是<code class="docutils literal notranslate"><span class="pre">QUIET</span></code>等来帮助解决这个问题。一个包的所有<code class="docutils literal notranslate"><span class="pre">REQUIRED</span></code>依赖项都应该在<code class="docutils literal notranslate"><span class="pre">Config.cmake</span></code>文件中找到：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">include(</span><span class="nb">CMakeFindDependencyMacro</span><span class="nf">)</span>
<span class="nf">find_dependency(</span><span class="nb">Stats</span><span class="w"> </span><span class="m">2.6.4</span><span class="nf">)</span>

<span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStatsTargets.cmake&quot;</span><span class="nf">)</span>
<span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStatsMacros.cmake&quot;</span><span class="nf">)</span>
</pre></div>
</div>
<p>如果没有找到依赖项，<code class="docutils literal notranslate"><span class="pre">find_dependency</span></code>宏还会将<code class="docutils literal notranslate"><span class="pre">ClimbingStats_FOUND</span></code>设置为<code class="docutils literal notranslate"><span class="pre">False</span></code>，并同时抛出一个诊断：没有<code class="docutils literal notranslate"><span class="pre">Stats</span></code>包就不能使用<code class="docutils literal notranslate"><span class="pre">ClimbingStats</span></code>包。</p>
<p>如果在下游使用<span class="target" id="index-12-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>时指定了<code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>，它们将在<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_FIND_COMPONENTS</span></code>变量中列出。如果一个特定的组件是非可选的，那么<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_FIND_REQUIRED_&lt;comp&gt;</span></code>将为真。这可以通过包配置文件中的逻辑进行测试：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">include(</span><span class="nb">CMakeFindDependencyMacro</span><span class="nf">)</span>
<span class="nf">find_dependency(</span><span class="nb">Stats</span><span class="w"> </span><span class="m">2.6.4</span><span class="nf">)</span>

<span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStatsTargets.cmake&quot;</span><span class="nf">)</span>
<span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStatsMacros.cmake&quot;</span><span class="nf">)</span>

<span class="nf">set(</span><span class="nb">_ClimbingStats_supported_components</span><span class="w"> </span><span class="nb">Plot</span><span class="w"> </span><span class="nb">Table</span><span class="nf">)</span>

<span class="nf">foreach(</span><span class="nb">_comp</span><span class="w"> </span><span class="o">${</span><span class="nt">ClimbingStats_FIND_COMPONENTS</span><span class="o">}</span><span class="nf">)</span>
<span class="w">  </span><span class="nf">if</span> <span class="nf">(</span><span class="no">NOT</span><span class="w"> </span><span class="s">&quot;;${_ClimbingStats_supported_components};&quot;</span><span class="w"> </span><span class="no">MATCHES</span><span class="w"> </span><span class="s">&quot;;${_comp};&quot;</span><span class="nf">)</span>
<span class="w">    </span><span class="nf">set(</span><span class="nb">ClimbingStats_FOUND</span><span class="w"> </span><span class="nb">False</span><span class="nf">)</span>
<span class="w">    </span><span class="nf">set(</span><span class="nb">ClimbingStats_NOT_FOUND_MESSAGE</span><span class="w"> </span><span class="s">&quot;Unsupported component: ${_comp}&quot;</span><span class="nf">)</span>
<span class="w">  </span><span class="nf">endif()</span>
<span class="w">  </span><span class="nf">include(</span><span class="s">&quot;${CMAKE_CURRENT_LIST_DIR}/ClimbingStats${_comp}Targets.cmake&quot;</span><span class="nf">)</span>
<span class="nf">endforeach()</span>
</pre></div>
</div>
<p>此处，<code class="docutils literal notranslate"><span class="pre">ClimbingStats_NOT_FOUND_MESSAGE</span></code>被设置为一个诊断，意思是由于指定了无效组件而无法找到包。在<code class="docutils literal notranslate"><span class="pre">_FOUND</span></code>变量设置为<code class="docutils literal notranslate"><span class="pre">False</span></code>的任何情况下，都可以设置此消息变量，并显示给用户。</p>
<section id="id10">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">为构建树创建包配置文件</a><a class="headerlink" href="#id10" title="Link to this heading">¶</a></h4>
<p><span class="target" id="index-0-command:export"></span><a class="reference internal" href="../command/export.html#command:export" title="export(export)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(EXPORT)</span></code></a>命令创建一个特定于构建树的<span class="target" id="index-6-prop_tgt:IMPORTED"></span><a class="reference internal" href="../prop_tgt/IMPORTED.html#prop_tgt:IMPORTED" title="IMPORTED"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED</span></code></a>目标定义文件，并且不可重定位。你可以和适当的包配置文件及包版本文件一起使用，以定义无需安装即可使用的构建树包。构建树的消费者可以简单地确保<span class="target" id="index-0-variable:CMAKE_PREFIX_PATH"></span><a class="reference internal" href="../variable/CMAKE_PREFIX_PATH.html#variable:CMAKE_PREFIX_PATH" title="CMAKE_PREFIX_PATH"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_PREFIX_PATH</span></code></a>包含构建目录，或者在缓存中将<code class="docutils literal notranslate"><span class="pre">ClimbingStats_DIR</span></code>设置为<code class="docutils literal notranslate"><span class="pre">&lt;build_dir&gt;/ClimbingStats</span></code>。</p>
</section>
</section>
<section id="creating-relocatable-packages">
<span id="id11"></span><h3><a class="toc-backref" href="#id29" role="doc-backlink">创建浮动包</a><a class="headerlink" href="#creating-relocatable-packages" title="Link to this heading">¶</a></h3>
<p>可重定位的包不能引用构建包所在机器上的文件的绝对路径，因为它们在安装的机器上并不存在。</p>
<p>由<span class="target" id="index-3-command:install"></span><a class="reference internal" href="../command/install.html#export" title="install(export)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">install(EXPORT)</span></code></a>创建的包被设计为可重定位的，使用包的相对路径。在为<code class="docutils literal notranslate"><span class="pre">EXPORT</span></code>定义目标的接口时，请记住include目录应该指定为相对于<span class="target" id="index-1-variable:CMAKE_INSTALL_PREFIX"></span><a class="reference internal" href="../variable/CMAKE_INSTALL_PREFIX.html#variable:CMAKE_INSTALL_PREFIX" title="CMAKE_INSTALL_PREFIX"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code></a>的相对路径：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">target_include_directories(</span><span class="nb">tgt</span><span class="w"> </span><span class="no">INTERFACE</span>
<span class="w">  </span><span class="c"># Wrong, not relocatable:</span>
<span class="w">  </span><span class="o">$&lt;</span><span class="no">INSTALL_INTERFACE</span><span class="o">:${</span><span class="nt">CMAKE_INSTALL_PREFIX</span><span class="o">}</span><span class="na">/include/TgtName</span><span class="o">&gt;</span>
<span class="nf">)</span>

<span class="nf">target_include_directories(</span><span class="nb">tgt</span><span class="w"> </span><span class="no">INTERFACE</span>
<span class="w">  </span><span class="c"># Ok, relocatable:</span>
<span class="w">  </span><span class="o">$&lt;</span><span class="no">INSTALL_INTERFACE</span><span class="o">:</span><span class="na">include/TgtName</span><span class="o">&gt;</span>
<span class="nf">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$&lt;INSTALL_PREFIX&gt;</span></code><span class="target" id="index-0-manual:cmake-generator-expressions(7)"></span><a class="reference internal" href="cmake-generator-expressions.7.html#manual:cmake-generator-expressions(7)" title="cmake-generator-expressions(7)"><code class="xref cmake cmake-manual docutils literal notranslate"><span class="pre">生成器表达式</span></code></a>可以用作安装前缀的占位符，而不会导致不可重定位的包。如果使用复杂的生成器表达式，这是必须的：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">target_include_directories(</span><span class="nb">tgt</span><span class="w"> </span><span class="no">INTERFACE</span>
<span class="w">  </span><span class="c"># Ok, relocatable:</span>
<span class="w">  </span><span class="o">$&lt;</span><span class="no">INSTALL_INTERFACE</span><span class="o">:$&lt;$&lt;</span><span class="no">CONFIG</span><span class="o">:</span><span class="nb">Debug</span><span class="o">&gt;:$&lt;</span><span class="no">INSTALL_PREFIX</span><span class="o">&gt;</span><span class="na">/include/TgtName</span><span class="o">&gt;&gt;</span>
<span class="nf">)</span>
</pre></div>
</div>
<p>这也适用于引用外部依赖项的路径。不建议用与依赖相关的路径填充任何可能包含路径的属性，例如<span class="target" id="index-2-prop_tgt:INTERFACE_INCLUDE_DIRECTORIES"></span><a class="reference internal" href="../prop_tgt/INTERFACE_INCLUDE_DIRECTORIES.html#prop_tgt:INTERFACE_INCLUDE_DIRECTORIES" title="INTERFACE_INCLUDE_DIRECTORIES"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_INCLUDE_DIRECTORIES</span></code></a>和<span class="target" id="index-0-prop_tgt:INTERFACE_LINK_LIBRARIES"></span><a class="reference internal" href="../prop_tgt/INTERFACE_LINK_LIBRARIES.html#prop_tgt:INTERFACE_LINK_LIBRARIES" title="INTERFACE_LINK_LIBRARIES"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_LINK_LIBRARIES</span></code></a>。例如，下面这段代码可能不适用于可重定位包：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">target_link_libraries(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">INTERFACE</span>
<span class="w">  </span><span class="o">${</span><span class="nt">Foo_LIBRARIES</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nt">Bar_LIBRARIES</span><span class="o">}</span>
<span class="w">  </span><span class="nf">)</span>
<span class="nf">target_include_directories(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">INTERFACE</span>
<span class="w">  </span><span class="s">&quot;$&lt;INSTALL_INTERFACE:${Foo_INCLUDE_DIRS};${Bar_INCLUDE_DIRS}&gt;&quot;</span>
<span class="w">  </span><span class="nf">)</span>
</pre></div>
</div>
<p>被引用的变量可能包含库的绝对路径，并包含<strong>在生成包的机器上找到的</strong>目录。这将创建一个带有硬编码的依赖路径的包，不适合重新定位。</p>
<p>理想情况下，这些依赖项应该通过它们自己的<a class="reference internal" href="cmake-buildsystem.7.html#imported-targets"><span class="std std-ref">IMPORTED targets</span></a>来使用，这些目标有它们自己的<span class="target" id="index-0-prop_tgt:IMPORTED_LOCATION"></span><a class="reference internal" href="../prop_tgt/IMPORTED_LOCATION.html#prop_tgt:IMPORTED_LOCATION" title="IMPORTED_LOCATION"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">IMPORTED_LOCATION</span></code></a>和使用需求属性，比如适当填充的<span class="target" id="index-3-prop_tgt:INTERFACE_INCLUDE_DIRECTORIES"></span><a class="reference internal" href="../prop_tgt/INTERFACE_INCLUDE_DIRECTORIES.html#prop_tgt:INTERFACE_INCLUDE_DIRECTORIES" title="INTERFACE_INCLUDE_DIRECTORIES"><code class="xref cmake cmake-prop_tgt docutils literal notranslate"><span class="pre">INTERFACE_INCLUDE_DIRECTORIES</span></code></a>。这些导入的目标可以和<code class="docutils literal notranslate"><span class="pre">ClimbingStats</span></code>的<span class="target" id="index-1-command:target_link_libraries"></span><a class="reference internal" href="../command/target_link_libraries.html#command:target_link_libraries" title="target_link_libraries"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">target_link_libraries()</span></code></a>命令一起使用：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">target_link_libraries(</span><span class="nb">ClimbingStats</span><span class="w"> </span><span class="no">INTERFACE</span><span class="w"> </span><span class="nb">Foo</span><span class="o">::</span><span class="nb">Foo</span><span class="w"> </span><span class="nb">Bar</span><span class="o">::</span><span class="nb">Bar</span><span class="nf">)</span>
</pre></div>
</div>
<p>使用这种方法，包仅通过<a class="reference internal" href="cmake-buildsystem.7.html#imported-targets"><span class="std std-ref">IMPORTED targets</span></a>的名称引用其外部依赖项。当使用者使用安装的包时，使用者将运行适当的<span class="target" id="index-13-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令（通过上面描述的<code class="docutils literal notranslate"><span class="pre">find_dependency</span></code>宏）来查找依赖项，并在自己的机器上使用适当的路径填充导入的目标。</p>
<p>不幸的是，CMake附带的许多<span class="target" id="index-0-manual:cmake-modules(7)"></span><a class="reference internal" href="cmake-modules.7.html#manual:cmake-modules(7)" title="cmake-modules(7)"><code class="xref cmake cmake-manual docutils literal notranslate"><span class="pre">modules</span></code></a>还没有提供<a class="reference internal" href="cmake-buildsystem.7.html#imported-targets"><span class="std std-ref">IMPORTED targets</span></a>，因为它们的开发早于这种方法。这可能会随着时间的推移而逐渐改善。使用这些模块创建可重定位包的工作包括：</p>
<ul class="simple">
<li><p>在构建包时，将每个<code class="docutils literal notranslate"><span class="pre">Foo_LIBRARY</span></code>缓存项指定为库名，例如<code class="docutils literal notranslate"><span class="pre">-DFoo_LIBRARY=foo</span></code>。这告诉相应的find模块只使用<code class="docutils literal notranslate"><span class="pre">foo</span></code>填充<code class="docutils literal notranslate"><span class="pre">Foo_LIBRARIES</span></code>，以要求链接器搜索库，而不是硬编码路径。</p></li>
<li><p>或者，在安装包内容之后，但在创建用于重新分发的包安装二进制文件之前，使用占位符手动替换绝对路径，以便在安装包时由安装工具替换。</p></li>
</ul>
</section>
</section>
<section id="package-registry">
<span id="id12"></span><h2><a class="toc-backref" href="#id30" role="doc-backlink">包注册</a><a class="headerlink" href="#package-registry" title="Link to this heading">¶</a></h2>
<p>CMake提供了两个中心位置来注册已经在系统中构建或安装的包：</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id13">用户包注册</a></p></li>
<li><p><a class="reference internal" href="#id14">系统包注册</a></p></li>
</ul>
<p>注册表对于帮助项目在非标准安装位置或直接在它们自己的构建树中找到包特别有用。项目可以填充用户或系统注册表（使用它自己的方法，参见下面）来引用它的位置。在这两种情况下，包都应该在注册位置存储一个<a class="reference internal" href="#id6">包配置文件</a>（<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;Config.cmake</span></code>）和一个<a class="reference internal" href="#id7">包版本文件</a>（<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;ConfigVersion.cmake</span></code>）。</p>
<p>作为其文档中指定的两个搜索步骤，<span class="target" id="index-14-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令会搜索两个包注册中心。如果有足够的权限的话，它还会删除陈旧的包注册表项，这些注册表项引用的目录不存在或不包含匹配的包配置文件。</p>
<section id="user-package-registry">
<span id="id13"></span><h3><a class="toc-backref" href="#id31" role="doc-backlink">用户包注册</a><a class="headerlink" href="#user-package-registry" title="Link to this heading">¶</a></h3>
<p>用户包注册表存储在每个用户的位置中。可以使用<span class="target" id="index-1-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>命令在用户包注册表中注册项目构建树。CMake目前没有提供将安装树添加到用户包注册表的接口。如果需要，必须手动指定安装程序注册包的方法。</p>
<p>在Windows上，用户包注册表存储在Windows注册表<code class="docutils literal notranslate"><span class="pre">HKEY_CURRENT_USER</span></code>的一个键下。</p>
<p>譬如<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;</span></code>可能出现在注册表如下位置：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>HKEY_CURRENT_USER\Software\Kitware\CMake\Packages\&lt;PackageName&gt;
</pre></div>
</div>
<p>作为一个<code class="docutils literal notranslate"><span class="pre">REG_SZ</span></code>值，可以使用任意名称，指定包配置文件所在的目录。</p>
<p>在UNIX平台上，用户包注册表存储在用户主目录<code class="docutils literal notranslate"><span class="pre">~/.cmake/packages</span></code>下。<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;</span></code>可能的路径是：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>~/.cmake/packages/&lt;PackageName&gt;
</pre></div>
</div>
<p>作为一个文件，可以使用任意的名称，其内容指定包配置文件所在的目录。</p>
</section>
<section id="system-package-registry">
<span id="id14"></span><h3><a class="toc-backref" href="#id32" role="doc-backlink">系统包注册</a><a class="headerlink" href="#system-package-registry" title="Link to this heading">¶</a></h3>
<p>系统包注册表存储在系统范围的位置中。CMake目前没有提供添加到系统包注册表的接口。如果需要，必须手动指定安装程序注册包的方法。</p>
<p>在Windows上，系统包注册表存储在Windows注册表<code class="docutils literal notranslate"><span class="pre">HKEY_LOCAL_MACHINE</span></code>的一个键下。<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;</span></code>应该出现在注册表项如下位置：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>HKEY_LOCAL_MACHINE\Software\Kitware\CMake\Packages\&lt;PackageName&gt;
</pre></div>
</div>
<p>作为一个<code class="docutils literal notranslate"><span class="pre">REG_SZ</span></code>值，可以使用任意名称，指定包配置文件所在的目录。</p>
<p>在非windows平台上没有系统包注册表。</p>
</section>
<section id="disabling-the-package-registry">
<span id="id15"></span><h3><a class="toc-backref" href="#id33" role="doc-backlink">禁用包注册表</a><a class="headerlink" href="#disabling-the-package-registry" title="Link to this heading">¶</a></h3>
<p>在某些情况下，不需要使用包注册表。CMake允许你用以下变量禁用它们：</p>
<ul class="simple">
<li><p>当<span class="target" id="index-0-policy:CMP0090"></span><a class="reference internal" href="../policy/CMP0090.html#policy:CMP0090" title="CMP0090"><code class="xref cmake cmake-policy docutils literal notranslate"><span class="pre">CMP0090</span></code></a>设置为<code class="docutils literal notranslate"><span class="pre">NEW</span></code>时，<span class="target" id="index-2-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>命令不会填充用户包注册表，除非<span class="target" id="index-0-variable:CMAKE_EXPORT_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_EXPORT_PACKAGE_REGISTRY.html#variable:CMAKE_EXPORT_PACKAGE_REGISTRY" title="CMAKE_EXPORT_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_EXPORT_PACKAGE_REGISTRY</span></code></a>变量明确启用它。如果<span class="target" id="index-1-policy:CMP0090"></span><a class="reference internal" href="../policy/CMP0090.html#policy:CMP0090" title="CMP0090"><code class="xref cmake cmake-policy docutils literal notranslate"><span class="pre">CMP0090</span></code></a><em>没有</em>设置为<code class="docutils literal notranslate"><span class="pre">NEW</span></code>，那么<span class="target" id="index-3-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>将填充用户包注册表，除非<span class="target" id="index-0-variable:CMAKE_EXPORT_NO_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_EXPORT_NO_PACKAGE_REGISTRY.html#variable:CMAKE_EXPORT_NO_PACKAGE_REGISTRY" title="CMAKE_EXPORT_NO_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_EXPORT_NO_PACKAGE_REGISTRY</span></code></a>变量明确禁用它。</p></li>
<li><p><span class="target" id="index-0-variable:CMAKE_FIND_USE_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_FIND_USE_PACKAGE_REGISTRY.html#variable:CMAKE_FIND_USE_PACKAGE_REGISTRY" title="CMAKE_FIND_USE_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_FIND_USE_PACKAGE_REGISTRY</span></code></a>设置为<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>后，所有<span class="target" id="index-15-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>调用中用户包注册表无效。</p></li>
<li><p>当被废弃的<span class="target" id="index-0-variable:CMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY.html#variable:CMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY" title="CMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_FIND_PACKAGE_NO_PACKAGE_REGISTRY</span></code></a>设置为<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>时，会在所有<span class="target" id="index-16-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>调用中禁用用户包注册。但能设置<span class="target" id="index-1-variable:CMAKE_FIND_USE_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_FIND_USE_PACKAGE_REGISTRY.html#variable:CMAKE_FIND_USE_PACKAGE_REGISTRY" title="CMAKE_FIND_USE_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_FIND_USE_PACKAGE_REGISTRY</span></code></a>来忽略该变量。</p></li>
<li><p><span class="target" id="index-0-variable:CMAKE_FIND_PACKAGE_NO_SYSTEM_PACKAGE_REGISTRY"></span><a class="reference internal" href="../variable/CMAKE_FIND_PACKAGE_NO_SYSTEM_PACKAGE_REGISTRY.html#variable:CMAKE_FIND_PACKAGE_NO_SYSTEM_PACKAGE_REGISTRY" title="CMAKE_FIND_PACKAGE_NO_SYSTEM_PACKAGE_REGISTRY"><code class="xref cmake cmake-variable docutils literal notranslate"><span class="pre">CMAKE_FIND_PACKAGE_NO_SYSTEM_PACKAGE_REGISTRY</span></code></a>能在所有<span class="target" id="index-17-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>调用中禁用系统包注册表。</p></li>
</ul>
</section>
<section id="id16">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">包注册例子</a><a class="headerlink" href="#id16" title="Link to this heading">¶</a></h3>
<p>命名包注册表项的一个简单约定是使用内容散列。它们是确定的，不太可能发生冲突（<span class="target" id="index-4-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>就使用这种方法）。引用特定目录的条目的名称只是目录路径本身的内容散列。</p>
<p>如果项目安排包注册表项存在，例如：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt; reg query HKCU\Software\Kitware\CMake\Packages\MyPackage
HKEY_CURRENT_USER\Software\Kitware\CMake\Packages\MyPackage
 45e7d55f13b87179bb12f907c8de6fc4 REG_SZ c:/Users/Me/Work/lib/cmake/MyPackage
 7b4a9844f681c80ce93190d4e3185db9 REG_SZ c:/Users/Me/Work/MyPackage-build
</pre></div>
</div>
<p>或者：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat ~/.cmake/packages/MyPackage/7d1fb77e07ce59a81bed093bbee945bd
/home/me/work/lib/cmake/MyPackage
$ cat ~/.cmake/packages/MyPackage/f92c1db873a1937f3100706657c63e07
/home/me/work/MyPackage-build
</pre></div>
</div>
<p>然后CMakeLists.txt代码：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nf">find_package(</span><span class="nb">MyPackage</span><span class="nf">)</span>
</pre></div>
</div>
<p>将搜索包配置文件（<code class="docutils literal notranslate"><span class="pre">MyPackageConfig.cmake</span></code>）的注册位置。单个包的包注册表项之间的搜索顺序是未指定的，并且条目名称（本例中的散列）没有任何意义。注册位置可能包含包版本文件（<code class="docutils literal notranslate"><span class="pre">MyPackageConfigVersion.cmake</span></code>）来告诉<span class="target" id="index-18-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>某个特定位置是否适合所请求的版本。</p>
</section>
<section id="id17">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">包注册所有权</a><a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<p>包注册表项由它们所引用的项目安装单独拥有。包安装程序负责添加它自己的条目，相应的卸载程序负责删除它。</p>
<p><span class="target" id="index-5-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>命令用项目构建树的位置填充用户包注册表。构建树往往由开发人员删除，并且没有可能触发删除其条目的“卸载”事件。为了保持注册表的整洁，如果有足够的权限，<span class="target" id="index-19-command:find_package"></span><a class="reference internal" href="../command/find_package.html#command:find_package" title="find_package"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">find_package()</span></code></a>命令会自动删除它遇到的过时条目。调用<span class="target" id="index-6-command:export"></span><a class="reference internal" href="../command/export.html#package" title="export(package)"><code class="xref cmake cmake-command docutils literal notranslate"><span class="pre">export(PACKAGE)</span></code></a>之后，CMake没有提供接口来删除引用现有构建树的条目。但是，如果项目从构建树中删除了它的包配置文件，那么引用该位置的条目将被认为是过时的。</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">cmake-packages(7)</a><ul>
<li><a class="reference internal" href="#id2">引言</a></li>
<li><a class="reference internal" href="#id3">使用包</a><ul>
<li><a class="reference internal" href="#config-file-packages">配置文件包</a></li>
<li><a class="reference internal" href="#find">Find模块包</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">包布局</a><ul>
<li><a class="reference internal" href="#id6">包配置文件</a></li>
<li><a class="reference internal" href="#id7">包版本文件</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-packages">创建包</a><ul>
<li><a class="reference internal" href="#id9">创建包配置文件</a><ul>
<li><a class="reference internal" href="#id10">为构建树创建包配置文件</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-relocatable-packages">创建浮动包</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-registry">包注册</a><ul>
<li><a class="reference internal" href="#user-package-registry">用户包注册</a></li>
<li><a class="reference internal" href="#system-package-registry">系统包注册</a></li>
<li><a class="reference internal" href="#disabling-the-package-registry">禁用包注册表</a></li>
<li><a class="reference internal" href="#id16">包注册例子</a></li>
<li><a class="reference internal" href="#id17">包注册所有权</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一主题</h4>
    <p class="topless"><a href="../module/CPackWIX.html"
                          title="上一章">CPackWIX</a></p>
  </div>
  <div>
    <h4>下一主题</h4>
    <p class="topless"><a href="cmake-policies.7.html"
                          title="下一章">cmake-policies(7)</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/manual/cmake-packages.7.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总索引"
             >索引</a></li>
        <li class="right" >
          <a href="cmake-policies.7.html" title="cmake-policies(7)"
             >下一页</a> |</li>
        <li class="right" >
          <a href="../module/CPackWIX.html" title="CPackWIX"
             >上一页</a> |</li>
  <li>
    <img src="../_static/cmake-logo-16.png" alt=""
         style="vertical-align: middle; margin-top: -2px" />
  </li>
  <li>
    <a href="https://cmake.org/">CMake</a> &#187;
  </li>
  <li>
    <a href="../index.html">3.29.1-g21d0c57 Documentation</a> &#187;
  </li>

        <li class="nav-item nav-item-this"><a href="">cmake-packages(7)</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
    &#169; 版权所有 2000-2024 Kitware, Inc. and Contributors.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6创建。
    </div>
  </body>
</html>